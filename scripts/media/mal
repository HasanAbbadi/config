#!/bin/sh

mySearch(){
    SEARCH=$@
    URL="http://google.com/search?hl=en&safe=off&q="
    STRING=`echo $SEARCH | sed 's/ /%20/g'`
    URI="$URL%22$STRING%22"
    
    lynx -dump $URI > gone.tmp
    sed 's/http/\^http/g' gone.tmp | tr -s "^" "\n" | grep http| sed 's/\ .*//g' > gtwo.tmp
    rm gone.tmp
    sed '/google.com/d' gtwo.tmp > urls
    rm gtwo.tmp
    
    echo ""
    cat urls
    echo ""

}

(mySearch ""$@" myanimelist") >/dev/null

wget -O "$@" $(cat urls | head -n1 ) 2>/dev/null

myWord="$(html2text "$@" | grep -iF 'Synopsis' -A 2 | tail -n1 | cut -d ' ' -f 1-4)"

html2text "$@" > html2text"$@".txt 


echo -e "$(tput setaf 2)---------------------------------------"

echo "Title:$(grep -iF "ALternative Titles" -A 2 html2text"$@".txt | tail -n1 | sed 's/English://g')"
echo -e "\b"
grep -iF "score:" html2text"$1".txt | tail -n1
echo -e "\b"
grep -iF "ranked:" html2text"$1".txt | tail -n1
echo -e "\b"


echo "Synopsis:"
echo -e "$(tput setaf 7)\b"
awk -v RS='' "/$myWord/" html2text"$@".txt 
echo -e "$(tput setaf 2)---------------------------------------"

grep -iF "information" -A 30 html2text"$1".txt |sed -n '/--/q;p'| sed "s/([^)]*)//g" | sed 1d

rm urls
rm "$@"
rm html2text"$@".txt
